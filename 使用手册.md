# 股票策略回测与分析系统 - 使用手册

**版本**: 6.0.0
**更新日期**: 2026-01-20
**作者**: Manus AI

---

## 1. 核心使用流程与执行顺序

项目的使用流程严格遵循 **数据 -> 计算 -> 展示** 的顺序。

### 1.1. 推荐执行顺序

在完成环境部署后，所有脚本都在 `py_file/` 目录下执行。

| 步骤 | 脚本 | 目的 | 推荐命令 |
| :--- | :--- | :--- | :--- |
| **1. 数据准备** | `a1_data_fetcher.py` | 首次使用或数据不完整时，下载全量数据。 | `python3 a1_data_fetcher.py --full` |
| **2. 自动化更新** | `a0_auto_update_daily.py` | 每日收盘后，一键完成数据更新、所有回测、分析、模型评分和预测。 | `python3 a0_auto_update_daily.py` |
| **3. 启动Web** | N/A | 启动前端服务，查看结果。 | `cd web && pnpm dev` |

### 1.2. 脚本执行依赖关系

| 脚本 | 依赖数据/脚本 | 输出数据 | 影响Web模块 |
| :--- | :--- | :--- | :--- |
| `a1_data_fetcher.py` | 外部API | `data/day/*.csv` | **回测数据** |
| `a2_single_strategy_backtest.py` | `a1_data_fetcher.py` | `backtest_single.json` | **回测数据** |
| `a3_combo_strategy_backtest.py` | `a1_data_fetcher.py` | `backtest_combo.json` | **回测数据** |
| `a4_signal_success_scanner.py` | `a1_data_fetcher.py` | `signal_summary.json` | **分析报告** |
| `a21_pattern_analyzer.py` | `a4_signal_success_scanner.py` | `pattern_summary.json` | **分析报告** |
| `a5_generate_stock_reports.py` | `a1_data_fetcher.py` | `stock_reports.json` | **报告明细, 可视化买点** |
| `a6_models.py` | `a1_data_fetcher.py` | `dashboard.json` | **模型仪表盘** |
| `a7_advanced_forecast.py` | `a1_data_fetcher.py` | `forecast_summary.json` | **预测数据** |
| `a99_update_web_data.py` | `a2, a3, a4, a5, a6, a7` | `strategies.json` | **指标方案** |
| `a0_auto_update_daily.py` | **所有脚本** | **所有JSON文件** | **所有Web模块** |

---

## 2. 脚本参数详解与使用场景

所有脚本都支持 `--limit` 参数来限制处理的股票数量，用于快速测试。

### 2.1. 数据下载脚本 (`a1_data_fetcher.py`)

| 参数 | 格式 | 描述 | 使用场景 |
| :--- | :--- | :--- | :--- |
| `--full` | 无 | **全量下载**所有A股和指数的历史日线数据。 | 首次部署或需要重新下载所有数据时。 |
| `--today` | 无 | **当日增量更新**，仅下载最新的交易日数据。 | 每日定时任务，用于数据维护。 |
| `--date` | `YYYYMMDD YYYYMMDD` | 下载指定日期范围的数据，并**覆盖**本地文件中的该时间段数据。 | 修复特定日期的数据错误，或回测特定时间段。 |

### 2.2. 回测脚本 (`a2_single_strategy_backtest.py`, `a3_combo_strategy_backtest.py`)

回测脚本支持**增量模式**，会自动跳过未更新的股票数据，极大提升运行效率。

| 脚本 | 参数 | 格式 | 描述 | 使用场景 |
| :--- | :--- | :--- | :--- | :--- |
| `a2_single_...` | `--strategy` | `[all|six_veins|buy_sell|chan|sell_optimize]` | 指定运行的单指标策略，默认为 `all`。 | 仅需验证特定策略的性能时。 |
| `a3_combo_...` | `--strategy` | `[all|steady|aggressive]` | 指定运行的组合策略，默认为 `all`。 | 仅需验证特定组合策略的性能时。 |
| **通用** | `--incremental` | 无 | **增量回测**（默认开启），仅处理数据有更新的股票。 | 日常维护，节省时间和资源。 |
| **通用** | `--full` | 无 | **全量回测**，强制重新计算所有股票。 | 修改策略逻辑后，需要重算历史表现。 |

### 2.3. AI模型与预测脚本 (`a6_models.py`, `a7_advanced_forecast.py`)

| 脚本 | 参数 | 格式 | 描述 | 使用场景 |
| :--- | :--- | :--- | :--- | :--- |
| `a6_models.py` | `--include-series` | 无 | 在输出中包含历史评分序列，用于展示趋势。 | 需要在模型仪表盘查看评分趋势时。 |
| `a7_advanced_forecast.py` | `--limit` | `[整数]` | 限制预测的股票数量。 | 快速生成预测数据进行验证。 |
| `a7_advanced_forecast.py` | `--market` | `[sh|sz|bj|all]` | 指定预测的市场，默认为 `all`。 | 仅需预测特定市场的股票时。 |

**示例**：
```bash
# 运行高级预测分析，限制前 100 只股票
python3 a7_advanced_forecast.py --limit 100
```

---

## 3. 自动化与定时任务

### 3.1. 自动化脚本 (`a0_auto_update_daily.py`)

该脚本是推荐的日常维护方式，支持多种运行模式：

| 模式 | 命令示例 | 行为描述 |
| :--- | :--- | :--- |
| **当日增量** | `python3 a0_auto_update_daily.py` | 下载今日数据，并进行增量回测、评分和预测。 |
| **日期范围** | `python3 a0_auto_update_daily.py 20250101 20250404` | 下载指定日期范围数据，并进行增量回测。 |
| **全量重算** | `python3 a0_auto_update_daily.py --full` | 全量下载所有历史数据，并进行全量回测和全量预测。 |

**执行顺序**：
1.  `a1_data_fetcher.py` (数据更新)
2.  `a4_signal_success_scanner.py` (信号扫描)
3.  `a21_pattern_analyzer.py` (模式分析)
4.  `a2_single_strategy_backtest.py` (单策略回测)
5.  `a3_combo_strategy_backtest.py` (组合策略回测)
6.  `a5_generate_stock_reports.py` (个股报告生成)
7.  `a6_models.py` (AI模型评分)
8.  `a7_advanced_forecast.py` (高级预测分析)
9.  `a99_update_web_data.py` (Web数据同步)

---

**文档结束**
