# 股票策略回测与分析系统 - 使用手册

**版本**: 7.0.0 (整合优化版)
**更新日期**: 2026-01-29
**作者**: Manus AI

---

## 1. 核心使用流程与执行顺序

项目已完成核心脚本的**统一化整合**，极大地简化了操作流程。目前遵循 **数据抓取 -> 统一回测 -> 模式分析 -> 统一分析** 的逻辑。

### 1.1. 推荐执行顺序

在完成环境部署后，所有脚本都在 `py_file/` 目录下执行。

| 步骤 | 脚本 | 目的 | 推荐命令 |
| :--- | :--- | :--- | :--- |
| **1. 自动化更新** | `a0_auto_update_daily.py` | **一键完成**数据更新、回测、分析、评分和预测。 | `python3 a0_auto_update_daily.py` |
| **2. 启动Web** | N/A | 启动前端服务，查看结果。 | `cd web && pnpm dev` |

### 1.2. 脚本执行依赖关系 (整合后)

| 脚本 | 整合的原脚本 | 输出数据 | 影响Web模块 |
| :--- | :--- | :--- | :--- |
| `a1_data_fetcher_mootdx.py` | N/A | `data/day/*.csv` | **基础行情数据** |
| `a2_unified_backtest.py` | `a2, a3, a4, a99_update` | `backtest_single.json`, `backtest_combo.json`, `signal_summary.json`, `strategies.json` | **回测数据, 分析报告, 指标方案** |
| `a21_pattern_analyzer.py` | N/A | `pattern_summary.json` | **分析报告 (模式特征)** |
| `a5_unified_analysis.py` | `a5, a6, a7` | `stock_reports.json`, `dashboard.json`, `forecast_summary.json` | **报告明细, 可视化买点, 模型仪表盘, 预测数据** |
| `a0_auto_update_daily.py` | **所有脚本** | **所有JSON文件** | **所有Web模块** |

---

## 2. 脚本参数详解与使用场景

### 2.1. 自动化主控脚本 (`a0_auto_update_daily.py`)

该脚本是日常维护的**唯一推荐入口**，它会自动按顺序调用其他子脚本。

| 模式 | 命令示例 | 行为描述 |
| :--- | :--- | :--- |
| **当日增量** | `python3 a0_auto_update_daily.py` | 增量下载今日数据，并进行增量回测、评分和预测。 |
| **日期范围** | `python3 a0_auto_update_daily.py 20250101 20251231` | 下载指定日期范围数据，并进行回测。 |
| **全量重算** | `python3 a0_auto_update_daily.py --full` | 全量下载所有历史数据，并进行全量回测和预测。 |

### 2.2. 统一回测引擎 (`a2_unified_backtest.py`)

整合了单指标、组合策略回测及信号扫描功能。

| 参数 | 格式 | 描述 |
| :--- | :--- | :--- |
| `--mode` | `single\|combo\|scan` | 指定运行模式：单策略、组合策略或信号扫描。 |
| `--strategy` | `all\|six_veins\|...` | 指定运行的特定策略，默认为 `all`。 |
| `--holding_days` | `[整数]` | 信号扫描模式下的持仓天数，默认为 `15`。 |

### 2.3. 统一分析引擎 (`a5_unified_analysis.py`)

整合了个股报告生成、AI模型评分和机器学习预测。

| 参数 | 格式 | 描述 |
| :--- | :--- | :--- |
| `--mode` | `all\|report\|dashboard\|forecast` | 指定运行模式，默认为 `all`。 |
| `--limit` | `[整数]` | 限制处理的股票数量（0为不限制），用于快速测试。 |
| `--hold_days` | `[整数]` | 报告统计中的持仓天数，默认为 `14`。 |

---

## 3. 常见操作示例

### 3.1. 首次部署后的初始化
```bash
cd py_file
python3 a0_auto_update_daily.py --full
```

### 3.2. 每日收盘后的例行更新
```bash
cd py_file
python3 a0_auto_update_daily.py
```

### 3.3. 仅更新预测数据 (快速测试)
```bash
cd py_file
python3 a5_unified_analysis.py --mode forecast --limit 100
```

---

**文档结束**
