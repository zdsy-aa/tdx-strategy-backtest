# 股票策略回测与分析系统 - 网页功能与数据交互深度说明文档

**版本**: 7.1.0
**更新日期**: 2026-01-29
**作者**: Manus AI

---

## 1. 核心交互架构

本系统采用 **“后端预计算 -> 静态 JSON 交付 -> 前端响应式渲染”** 的架构。所有网页展示的数据均来源于后端 Python 脚本生成的 JSON 文件。

### 1.1. 路径规范
*   **后端脚本路径**: `/home/ubuntu/tdx-strategy-backtest/py_file/`
*   **数据输出路径**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/`
*   **前端页面路径**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/`

---

## 2. 网页菜单与数据交互详解

### 2.1. 指标方案 (Strategies)
*   **功能作用**: 展示系统支持的所有技术指标及其计算公式、买卖逻辑。
*   **前端页面**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/Strategies.tsx`
*   **来源数据文件**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/strategies.json`
*   **生成脚本**: `py_file/a2_unified_backtest.py` (通过 `WebDataUpdater` 类更新)
*   **数据格式详解**:
    ```json
    {
      "indicators": [
        {
          "id": "six_veins",
          "name": "六脉神剑",
          "description": "多指标共振系统...",
          "subIndicators": [
            { "name": "MACD", "formula": "DIF > DEA", "meaning": "短期动能强于中期" }
          ],
          "signals": [
            { "type": "buy", "name": "涨买入", "condition": "六个指标首次全部变红" }
          ],
          "summary": { "winRate": "58.5%", "totalReturn": "125.4%" }
        }
      ]
    }
    ```
*   **展示逻辑**: 网页遍历 `indicators` 数组，为每个指标生成一个卡片。`subIndicators` 用于渲染公式列表，`summary` 用于在卡片顶部展示该策略的总体表现。

### 2.2. 模型仪表盘 (Model Dashboard)
*   **功能作用**: 提供全市场股票的实时评分排名，识别高强度信号。
*   **前端页面**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/ModelDashboard.tsx`
*   **来源数据文件**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/dashboard.json`
*   **生成脚本**: `py_file/a5_unified_analysis.py` (在 `--mode dashboard` 模式下)
*   **数据格式详解**:
    ```json
    {
      "updated_at": "2026-01-27 13:22:36",
      "symbols": [
        {
          "info": { "code": "603271", "name": "永杰新材", "price": 47.14, "pct_change": 2.5 },
          "signals": { "slot_a": true, "slot_b": false, "score": 5, "strength": "High" }
        }
      ]
    }
    ```
*   **展示逻辑**: 网页将 `symbols` 渲染为数据表格。`score` 决定了排序顺序，`strength` 字段用于触发 CSS 类名（如 `High` 对应红色背景，`Low` 对应灰色背景）。

### 2.3. 报告明细 (Reports) & 可视化买点
*   **功能作用**: 列出所有个股的回测绩效，并提供 K 线图买卖点可视化。
*   **前端页面**: 
    *   列表页: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/Reports.tsx`
    *   详情页: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/ReportDetail.tsx`
*   **来源数据文件**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/stock_reports.json`
*   **生成脚本**: `py_file/a5_unified_analysis.py` (在 `--mode report` 模式下)
*   **数据格式详解**:
    ```json
    [
      {
        "code": "301113",
        "name": "雅艺科技",
        "totalReturn": "-27.5%",
        "totalWinRate": "48.9%",
        "lastSignal": "六脉5红",
        "lastSignalDate": "2026/01/26",
        "trades": [
          { "date": "2025-12-01", "type": "buy", "price": 25.4 },
          { "date": "2025-12-15", "type": "sell", "price": 27.1 }
        ]
      }
    ]
    ```
*   **展示逻辑**: 
    *   **列表页**: 渲染为带搜索功能的表格，展示 `totalReturn` 和 `lastSignal`。
    *   **详情页**: 提取 `trades` 数组，将其坐标映射到 K 线图组件（如 `Recharts`）上，在对应日期绘制“买/卖”图标。

### 2.4. 分析报告 (Analysis Report)
*   **功能作用**: 展示全市场信号成功率统计及模式分析结果。
*   **前端页面**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/AnalysisReport.tsx`
*   **来源数据文件**: 
    *   `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/signal_summary.json`
    *   `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/pattern_analysis_summary.json`
*   **生成脚本**: 
    *   `py_file/a2_unified_backtest.py` (信号扫描模式)
    *   `py_file/a21_pattern_analyzer.py` (模式分析)
*   **数据格式详解**:
    ```json
    {
      "success_rate": 31.47,
      "signal_type_counts": { "six_veins": 1112016, "chan_buy": 566377 },
      "future_return_mean": 19.29
    }
    ```
*   **展示逻辑**: 网页使用饼图展示 `signal_type_counts` 的分布，使用仪表盘组件展示 `success_rate`。

### 2.5. 预测数据 (Forecast)
*   **功能作用**: 展示基于机器学习的未来走势预测。
*   **前端页面**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/pages/ForecastDashboard.tsx`
*   **来源数据文件**: `/home/ubuntu/tdx-strategy-backtest/web/client/src/data/forecast_summary.json`
*   **生成脚本**: `py_file/a5_unified_analysis.py` (在 `--mode forecast` 模式下)
*   **数据格式详解**:
    ```json
    {
      "generated_at": "2026-01-23",
      "all_predictions": [
        {
          "code": "000001",
          "current_price": 15.2,
          "predicted_price": 16.5,
          "confidence": 0.85,
          "trend": "Up"
        }
      ]
    }
    ```
*   **展示逻辑**: 网页将 `all_predictions` 渲染为预测列表。`confidence` 转化为进度条显示，`trend` 决定箭头的方向（向上或向下）。

---

## 3. 网页数据加载流程

1.  **初始化**: 用户访问网页，React 根组件加载。
2.  **异步请求**: 各页面组件通过 `fetch('/src/data/xxx.json')` 获取数据。
3.  **状态存储**: 数据被存入 React 的 `useState` 钩子中。
4.  **计算属性**: 网页会对原始数据进行二次处理（如过滤掉 `totalTrades` 为 0 的股票）。
5.  **渲染**: 使用 TailwindCSS 布局，将处理后的数据填入 HTML 模板。

---

**文档结束**
