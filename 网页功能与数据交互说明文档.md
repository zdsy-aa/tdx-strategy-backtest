# 股票策略回测与分析系统 - 网页功能与数据交互说明文档

**版本**: 7.0.0
**更新日期**: 2026-01-29
**作者**: Manus AI

---

## 1. 总体架构逻辑

本系统的前端网页采用 **React + Vite + TailwindCSS** 构建，核心逻辑为 **“静态数据驱动”**。

1.  **后端脚本**（Python）负责复杂的量化计算和数据处理。
2.  **输出文件**：脚本将结果以 `.json` 格式保存到前端项目的 `web/client/src/data/` 目录下。
3.  **前端加载**：网页启动后，通过 `fetch` 或直接 `import` 这些 JSON 文件，利用 React 的状态管理（State）将数据渲染到 UI 组件中。

---

## 2. 脚本、文件与网页菜单映射表

下表详细列出了每个网页菜单背后的数据来源、生成脚本及核心操作。

| 网页菜单 | 对应前端页面 | 数据来源文件 (在 `src/data/` 下) | 生成脚本 (在 `py_file/` 下) | 脚本核心操作 |
| :--- | :--- | :--- | :--- | :--- |
| **回测数据** | `Backtest.tsx` | `backtest_single.json`<br>`backtest_combo.json` | `a2_unified_backtest.py` | 计算全市场股票在不同策略下的历史收益、胜率、回撤，并汇总元数据。 |
| **分析报告** | `AnalysisReport.tsx` | `signal_summary.json`<br>`pattern_summary.json` | `a2_unified_backtest.py`<br>`a21_pattern_analyzer.py` | 扫描信号成功案例，统计信号触发后的涨幅分布，分析成功案例的共性指标模式。 |
| **指标方案** | `Strategies.tsx` | `strategies.json` | `a2_unified_backtest.py` | 维护策略的描述、公式、买卖点逻辑，并关联最新的回测统计摘要。 |
| **报告明细** | `Reports.tsx` | `stock_reports.json` | `a5_unified_analysis.py` | 统计每只股票的累计收益、年化收益、交易次数及最新信号状态。 |
| **可视化买点** | `ReportDetail.tsx` | `stock_reports.json` | `a5_unified_analysis.py` | 提取个股历史交易的买入/卖出日期，用于在 K 线图上进行标注。 |
| **模型仪表盘** | `ModelDashboard.tsx` | `dashboard.json` | `a5_unified_analysis.py` | 综合多个策略槽位，对全市场股票进行实时评分、排名和强度分类。 |
| **预测数据** | `ForecastDashboard.tsx` | `forecast_summary.json` | `a5_unified_analysis.py` | 利用卡尔曼滤波和随机森林算法，计算股票未来的预测价格及置信区间。 |

---

## 3. 核心数据文件格式与展示逻辑

### 3.1. 指标方案 (`strategies.json`)
*   **格式**: 包含策略 ID、名称、描述、子指标公式及买卖信号定义。
*   **网页逻辑**: `Strategies.tsx` 读取此文件，生成策略卡片。用户点击卡片可查看该策略的详细逻辑和回测摘要。

### 3.2. 模型仪表盘 (`dashboard.json`)
*   **格式**:
    ```json
    {
      "updated_at": "2026-01-27",
      "symbols": [
        {
          "info": { "code": "603271", "name": "永杰新材", "price": 47.14 },
          "signals": { "score": 5, "strength": "High" }
        }
      ]
    }
    ```
*   **网页逻辑**: `ModelDashboard.tsx` 将数据渲染为表格，支持按分数（Score）排序。通过颜色高亮（如红色代表 High）直观展示高分股票。

### 3.3. 报告明细 (`stock_reports.json`)
*   **格式**: 数组形式，每个对象代表一只股票的绩效摘要（收益率、胜率、最后信号等）。
*   **网页逻辑**: `Reports.tsx` 提供搜索和过滤功能。用户输入代码后，网页从数组中筛选出匹配项并展示。

### 3.4. 预测数据 (`forecast_summary.json`)
*   **格式**: 包含股票代码、当前价、预测价、预测涨幅及置信度。
*   **网页逻辑**: `ForecastDashboard.tsx` 使用图表（如折线图）展示历史价格与预测价格的走势对比，并用阴影区域表示置信区间。

---

## 4. 网页如何使用数据文件进行展示

1.  **数据获取**: 网页组件挂载（`useEffect`）时，发起请求读取 JSON 文件。
2.  **数据处理**:
    *   **格式化**: 将 JSON 中的字符串百分比（如 `"27.5%"`）转换为数值以便排序。
    *   **分页**: 针对 `stock_reports.json` 等大数据文件，前端进行分页处理以保证流畅度。
3.  **可视化渲染**:
    *   **表格**: 使用 `lucide-react` 图标增强视觉效果。
    *   **图表**: 使用 `Recharts` 或 `Chart.js` 将 JSON 中的历史序列数据绘制成 K 线图或收益曲线。
    *   **状态标注**: 根据 JSON 中的信号值（如 `buy`, `sell`），在 UI 上渲染对应的红/绿标签。

---

## 5. 总结

本系统的网页本质上是一个**高级数据可视化终端**。它不直接连接数据库，而是通过读取后端预计算好的 JSON “快照”来展示信息。这种设计保证了前端的极速响应，同时也让后端可以专注于高性能的量化计算。

---

**文档结束**
