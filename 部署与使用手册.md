# 股票策略回测与分析系统 - 部署与使用手册

**版本**: 2.0.0
**更新日期**: 2026-01-15

---

## 1. 环境要求

在开始之前，请确保您的系统满足以下要求：

- **操作系统**: Linux (推荐), macOS, 或 Windows
- **Python**: 3.8 或更高版本
- **Node.js**: 16.0 或更高版本
- **包管理器**: `pip` (用于Python) 和 `pnpm` (用于Node.js, 推荐) 或 `npm`/`yarn`
- **Git**: 用于克隆代码仓库

---

## 2. 安装与配置

### 第1步：克隆代码仓库

打开终端，使用`git`命令克隆本项目到您的本地计算机。

```bash
# 克隆仓库
git clone https://github.com/zdsy-aa/tdx-strategy-backtest.git

# 进入项目目录
cd tdx-strategy-backtest
```

### 第2步：安装Python依赖

系统后端依赖于多个Python库来获取和处理数据。您可以使用`pip`和`requirements.txt`文件一键安装所有依赖。

```bash
# 进入Python代码目录
cd py_file

# 安装依赖
pip install -r ../requirements.txt
```

> **常见问题**:
> - 如果`pip`命令不可用，请尝试使用`pip3`。
> - 如果安装`akshare`时出现问题，可能需要安装一些编译工具。请参考`akshare`的官方文档。

### 第3步：安装前端依赖

系统前端是一个React应用，需要安装Node.js依赖。

```bash
# 进入Web前端目录
cd web

# 安装依赖 (推荐使用pnpm)
pnpm install

# 如果您没有pnpm，也可以使用npm或yarn
# npm install
# yarn install
```

---

## 3. 系统使用流程

系统的使用遵循“先后端，后前端”的原则。您必须先运行Python脚本生成数据，然后才能在Web界面上看到结果。

### 第1步：下载股票数据

这是所有分析的基础。首次使用时，需要下载全量的A股历史数据。

```bash
# 确保在 py_file 目录下
cd py_file

# 运行全量数据下载脚本
# 这个过程可能需要几个小时，具体取决于您的网络速度
python3 data_fetcher.py --all
```

下载完成后，数据会以CSV格式保存在`/data/day/`目录下。

**日常更新**: 每日收盘后（例如下午4点），您可以运行增量更新命令，只下载当天的新数据，这个过程很快。

```bash
python3 data_fetcher.py --today
```

### 第2步：运行回测与分析脚本

您可以根据需要运行以下任意脚本。所有脚本都会自动将结果输出到Web目录，无需手动操作。

```bash
# 确保在 py_file 目录下

# (可选) 运行单指标策略回测
# 耗时约10-20分钟
python3 single_strategy_backtest.py

# (可选) 运行组合策略回测
# 耗时约5-10分钟
python3 combo_strategy_backtest.py

# (可选) 运行信号成功案例扫描与分析
# 扫描过程约30-60分钟
python3 signal_success_scanner.py
# 分析过程约10-20分钟
python3 pattern_analyzer.py
```

> **性能提示**：以上脚本均支持多进程并行计算。如果您的计算机性能较好，可以适当调整脚本内的进程数以获得更快的速度。

### 第3步：启动Web前端服务

当您至少完成了一次回测或分析后，就可以启动Web服务来查看结果了。

```bash
# 确保在 web 目录下
cd web

# 启动开发服务器
pnpm dev
```

启动成功后，终端会显示一个本地访问地址，通常是 `http://localhost:5173`。

在浏览器中打开该地址，您就可以看到可视化的回测与分析报告了。

### 第4步：查看报告

- **Web界面**: 通过浏览器访问，提供交互式的图表和数据表格。
- **Markdown/CSV报告**: 在`/report/`目录下，存放了每次运行生成的详细报告文件，您可以直接打开查看。

---

## 4. 脚本命令行参数说明

为了方便测试和调试，部分脚本提供了命令行参数。

### `single_strategy_backtest.py`

- `--strategy [all|six_veins|buy_sell|chan|sell_optimize]`: 指定要运行的策略，默认为`all`。
- `--limit [整数]`: 限制处理的股票数量，用于快速测试。例如`--limit 100`只处理前100个股票。

### `combo_strategy_backtest.py`

- `--strategy [all|steady|aggressive]`: 指定要运行的组合策略，默认为`all`。
- `--limit [整数]`: 同上，限制处理的股票数量。

**示例**：只想快速测试一下稳健组合策略在100只股票上的表现。

```bash
python3 combo_strategy_backtest.py --strategy steady --limit 100
```

---

**手册结束**
结束**
结束**
结束**
结束**
