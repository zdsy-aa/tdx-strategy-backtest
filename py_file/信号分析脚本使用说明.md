# 信号成功案例分析脚本使用说明

## 一、概述

本项目包含两个Python分析脚本，用于自动化扫描股票历史数据，验证特定技术买入信号的有效性，并统计成功案例的共性特征。

### 脚本列表

| 脚本名称 | 功能说明 | 输出文件 |
|---------|---------|---------|
| `signal_success_scanner.py` | 信号检测与绩效验证 | `all_signal_records.csv`, `signal_success_cases.csv`, `signal_summary.json` |
| `pattern_analyzer.py` | 模式分析与统计 | `pattern_analysis_report.csv`, `pattern_summary.json`, `pattern_analysis_by_signal.json` |

---

## 二、信号检测规则

### 2.1 六脉神剑信号
- **触发条件**：六脉神剑指标中有4个或以上指标显示红色（多头状态）
- **包含指标**：MACD、KDJ、RSI、LWR、BBI、MTM
- **输出**：记录具体的红色指标组合（如 `MACD+KDJ+RSI+BBI`）

### 2.2 缠论买点信号
共5类标准买点：
| 买点类型 | 说明 |
|---------|------|
| 缠论一买 | 底背驰买点，五段下跌后的反转 |
| 缠论二买 | 回踩确认买点，三段/五段下跌后的回踩不破前低 |
| 缠论三买 | 中枢突破买点，回踩不进入中枢 |
| 缠论强二买 | 强势二买，特殊结构的二买变种 |
| 缠论类二买 | 类似二买，与强二买逻辑相同 |

### 2.3 买卖点信号
| 买点类型 | 说明 |
|---------|------|
| 买点1 | 吸筹值上穿14，主力开始吸筹 |
| 买点2 | 庄家线上穿散户线且处于低位（庄家<50） |

---

## 三、绩效验证条件

- **持仓天数**：15个交易日
- **成功标准**：信号出现日收盘价为基准，15个交易日内最大涨幅 > 5%
- **计算指标**：
  - `max_return_pct`：期间最大涨幅（基于最高价）
  - `final_return_pct`：15日后涨幅（基于收盘价）

---

## 四、模式分析维度

### 4.1 技术指标分析
| 指标 | 分析内容 |
|------|---------|
| MACD | DIF/DEA位置、金叉/死叉、零轴关系、趋势方向 |
| KDJ | K/D/J值、超买超卖、金叉/死叉 |
| BOLL | 布林带位置、带宽、收窄/扩张状态 |
| RSI | RSI6/12/24值、超买超卖、多头排列 |
| DMI | PDI/MDI关系、ADX趋势强度 |
| DMA | DIF与DIFMA关系、金叉信号 |
| SAR | 多空状态、价格与SAR关系 |
| BBI | 价格与BBI关系、BBI趋势 |
| OBV | OBV与均线关系、量价同步性 |
| WR | 威廉指标超买超卖 |
| CCI | 顺势指标状态 |

### 4.2 市场理论分析
| 理论 | 分析内容 |
|------|---------|
| 道氏理论 | 主要/次级/短期趋势、高低点结构、趋势确认 |
| 威科夫理论 | 市场阶段（吸筹/上涨/派发/下跌）、供需关系、成交量特征 |
| 均线系统 | 多头/空头排列、均线支撑数量、金叉信号 |

---

## 五、使用方法

### 5.1 运行信号扫描脚本

```bash
cd ~/tdx-strategy-backtest/py_file
python3 signal_success_scanner.py
```

**运行时间**：约30-60分钟（取决于数据量和CPU性能）

**输出文件**：
- `report/all_signal_records.csv`：所有信号记录（包含成功和失败）
- `report/signal_success_cases.csv`：仅成功案例
- `report/signal_summary.json`：统计摘要

### 5.2 运行模式分析脚本

```bash
cd ~/tdx-strategy-backtest/py_file
python3 pattern_analyzer.py
```

**前置条件**：需先运行 `signal_success_scanner.py` 生成成功案例数据

**输出文件**：
- `report/pattern_analysis_report.csv`：详细分析报告
- `report/pattern_summary.json`：模式统计摘要
- `report/pattern_analysis_by_signal.json`：按信号类型分类的统计

---

## 六、输出文件说明

### 6.1 signal_success_cases.csv 字段说明

| 字段名 | 说明 |
|-------|------|
| stock_code | 股票代码（格式：市场_代码，如 sz_000001） |
| stock_name | 股票名称 |
| date | 信号日期 |
| signal_type | 信号类型（六脉神剑/缠论一买/买卖点-买点1等） |
| signal_detail | 信号详情（六脉神剑显示具体组合） |
| six_veins_count | 六脉神剑红色数量（0-6） |
| entry_price | 入场价格（信号日收盘价） |
| max_return_pct | 15日内最大涨幅(%) |
| final_return_pct | 15日后涨幅(%) |
| is_success | 是否成功（True/False） |

### 6.2 signal_summary.json 结构

```json
{
  "scan_date": "扫描时间",
  "total_signals": "总信号数",
  "success_signals": "成功信号数",
  "overall_success_rate": "总体成功率",
  "by_signal_type": {
    "信号类型": {
      "total": "总数",
      "success": "成功数",
      "success_rate": "成功率",
      "avg_max_return": "平均最大涨幅",
      "avg_final_return": "平均最终涨幅"
    }
  },
  "six_veins_combos": {
    "组合名称": {
      "total": "总数",
      "success": "成功数",
      "success_rate": "成功率",
      "red_count": "红色指标数量"
    }
  }
}
```

### 6.3 pattern_summary.json 结构

```json
{
  "indicators": {
    "MACD": {
      "DIF在零轴上方": {"count": 100, "true_count": 75, "true_rate": 75.0}
    }
  },
  "theories": {
    "道氏理论": {
      "主要趋势": {"count": 100, "distribution": {"bullish": 60, "bearish": 40}}
    }
  }
}
```

---

## 七、参数配置

如需修改参数，请编辑脚本中的配置常量：

### signal_success_scanner.py
```python
HOLDING_DAYS = 15        # 持仓天数
SUCCESS_THRESHOLD = 5.0  # 成功阈值（涨幅百分比）
MIN_RED_COUNT = 4        # 六脉神剑最小红色数量
```

### pattern_analyzer.py
```python
# 无需额外配置，自动读取成功案例文件
```

---

## 八、注意事项

1. **数据要求**：确保 `data/day/` 目录下有足够的股票CSV数据
2. **内存消耗**：全量扫描时内存消耗较大，建议至少8GB内存
3. **运行时间**：首次运行可能需要较长时间，建议在服务器或高性能机器上运行
4. **多进程**：脚本使用多进程加速，会占用大部分CPU资源

---

## 九、常见问题

### Q1: 运行时报错 "成功案例文件不存在"
**A**: 请先运行 `signal_success_scanner.py` 生成成功案例数据

### Q2: 扫描速度太慢
**A**: 可以修改脚本中的 `max_workers` 参数调整并行进程数

### Q3: 如何只分析特定股票
**A**: 修改 `get_all_stock_files()` 函数，返回指定的股票文件列表

---

## 十、版本信息

- **版本**：1.0.0
- **创建日期**：2026-01-15
- **作者**：TradeGuide System
