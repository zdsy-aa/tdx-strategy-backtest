# 股票指标回测系统 - 详细开发说明

**版本**: 3.0.0
**更新日期**: 2026-01-11
**作者**: Manus AI

---

## 1. 系统概述

### 1.1. 功能与作用

股票指标回测系统（`tdx-strategy-backtest`）是一个基于 Python 和 React 的全栈量化交易策略回测平台。其核心作用是帮助投资者和研究人员验证各种技术指标策略在 A 股历史数据上的表现。

### 1.2. 技术架构

项目采用**前后端分离**的架构，并通过**静态数据文件（JSON）**进行解耦。

- **后端 (Python)**：负责数据下载、指标计算、策略回测，并将最终分析结果生成为 JSON 文件。
- **前端 (React)**：读取后端生成的 JSON 数据，进行可视化展示和交互操作。

---

## 2. Python 后端系统详解

Python 后端位于 `py_file/` 目录下，是整个系统的数据处理和分析核心。

### 2.1. 脚本命名规范
- **10开头**：单指标测试脚本。
- **20开头**：组合指标测试脚本。

### 2.2. 关键脚本说明

| 脚本文件 | 主要作用 | 数据来源 | 处理流程 | 输出文件 |
| :--- | :--- | :--- | :--- | :--- |
| `stock_downloader.py` | **数据下载工具** | akshare | 支持全量、增量、指定股票下载。具备自动停止机制（10天无交易跳过）。 | `data/day/` 下的 CSV 文件 |
| `full_backtest.py` | **核心回测引擎** | `data/day/` 下的 CSV | 加载数据、计算指标、执行回测、生成统计数据。 | `backtest_results.json`<br>`stock_reports.json` |
| `indicators.py` | **技术指标库** | (被调用) | 提供所有技术指标的数学计算函数。 | (无) |

### 2.3. 数据下载逻辑优化 (`stock_downloader.py`)
- **全量模式 (`--full`)**: 下载所有 A 股从上市至今的完整历史数据。
- **增量模式 (`--incremental`)**: 仅下载现有数据之后的更新数据，并与本地数据合并去重。
- **指定股票 (`--stocks`)**: 支持通过逗号分隔的代码列表下载特定股票。
- **自动停止机制**: 脚本会检查股票的最新交易日期。如果距离当前日期超过 15 天（约 10 个交易日）无交易记录，该股票将被加入 `config/skip_stocks.json`，后续下载将自动跳过，以节省资源并处理退市/停牌股票。

---

## 3. Web 前端系统详解

Web 前端位于 `web/` 目录下，负责将后端生成的复杂数据以用户友好的方式呈现。

### 3.1. 网页与数据来源

| 网页/组件 | 访问路径 | 功能说明 | 主要数据来源 |
| :--- | :--- | :--- | :--- |
| `Home.tsx` | `/` | **仪表盘**：系统概览、核心特点、精选策略展示。 | `strategies.json`, `backtest_results.json` |
| `Backtest.tsx` | `/backtest` | **回测数据验证**：展示总/年度/月度回测统计。 | `backtest_results.json` |
| `ReportDetail.tsx` | `/report-detail` | **报告明细**：展示所有个股的回测数据。 | `stock_reports.json` |

---

## 4. 安装与运行指南

### 4.1. 环境要求
- Python 3.10+
- Node.js 18+ & pnpm

### 4.2. 运行步骤

1. **安装依赖**: `pip install -r requirements.txt`
2. **下载数据**: `python py_file/stock_downloader.py --incremental`
3. **执行回测**: `python py_file/full_backtest.py`
4. **启动前端**: 在 `web` 目录下执行 `pnpm install && pnpm dev`
