# å›æµ‹ç³»ç»Ÿä¼˜åŒ–ä¸è‡ªåŠ¨åŒ–ä»»åŠ¡å®Œæˆæ€»ç»“

**æ—¥æœŸ**: 2026-01-09
**ç‰ˆæœ¬**: 2.2.0
**Commit**: 5786d725

---

## ğŸ“‹ ä»»åŠ¡æ¸…å•

### âœ… ä»»åŠ¡1ï¼šä¿®å¤ç½‘é¡µå›æµ‹æ•°æ®æŠ¥é”™

**é—®é¢˜æè¿°**ï¼š
- `Backtest.tsx` é¡µé¢è®¿é—®æ—¶æŠ¥é”™
- æ•°æ®ç»“æ„ç¼ºå°‘å¿…éœ€å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åˆ›å»º `py_file/fix_backtest_json.py` å¿«é€Ÿä¿®å¤è„šæœ¬
- è¡¥å…¨ç¼ºå¤±å­—æ®µï¼š`type`, `best_hold_days`, `monthly_stats`, `conclusions`, `last_update`
- ä¿®æ”¹ `full_backtest.py` ç¡®ä¿åç»­ç”Ÿæˆçš„æ•°æ®åŒ…å«å®Œæ•´å­—æ®µ

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `py_file/fix_backtest_json.py` (æ–°å¢)
- `py_file/full_backtest.py` (ä¿®æ”¹)
- `web/client/src/data/backtest_results.json` (ä¿®å¤)

---

### âœ… ä»»åŠ¡2ï¼šå®ç°æ¯å¤©16:00è‡ªåŠ¨ä¸‹è½½æ•°æ®å’Œå›æµ‹

**å®ç°æ–¹æ¡ˆ**ï¼š

#### 2.1. è‡ªåŠ¨åŒ–ä»»åŠ¡è„šæœ¬
åˆ›å»º `py_file/auto_update_daily.py`ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- è‡ªåŠ¨æ‰§è¡Œæ•°æ®ä¸‹è½½è„šæœ¬
- è‡ªåŠ¨æ‰§è¡Œå®Œæ•´å›æµ‹è„šæœ¬
- è®°å½•è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—
- å¼‚å¸¸å¤„ç†å’Œè¶…æ—¶æ§åˆ¶

#### 2.2. systemd timer (æ¨èæ–¹å¼)
åˆ›å»ºä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š
- `deploy/tdx-backtest-update.service` - æœåŠ¡å®šä¹‰
- `deploy/tdx-backtest-update.timer` - å®šæ—¶å™¨é…ç½®
- `deploy/install_timer.sh` - ä¸€é”®å®‰è£…è„šæœ¬

**ç‰¹ç‚¹**ï¼š
- æ¯å¤©16:00è‡ªåŠ¨æ‰§è¡Œ
- æ”¯æŒé”™è¿‡æ‰§è¡Œæ—¶é—´åè‡ªåŠ¨è¡¥æ‰§è¡Œ
- éšæœºå»¶è¿Ÿ0-5åˆ†é’Ÿé¿å…æœåŠ¡å™¨è´Ÿè½½å³°å€¼
- å®Œæ•´çš„æ—¥å¿—ç®¡ç†

#### 2.3. crontab (å¤‡é€‰æ–¹å¼)
åˆ›å»º `deploy/crontab.txt` æä¾› crontab é…ç½®ç¤ºä¾‹ã€‚

**æ–°å¢æ–‡ä»¶**ï¼š
- `py_file/auto_update_daily.py`
- `deploy/tdx-backtest-update.service`
- `deploy/tdx-backtest-update.timer`
- `deploy/install_timer.sh`
- `deploy/crontab.txt`

---

### âœ… ä»»åŠ¡3ï¼šæŠ¥å‘Šæ˜ç»†å¢åŠ å¸‚åœºåŒºåˆ†åŠŸèƒ½

**å®ç°åŠŸèƒ½**ï¼š
- æ·»åŠ å¸‚åœºç­›é€‰ä¸‹æ‹‰æ¡†
- æ”¯æŒç­›é€‰ï¼šå…¨éƒ¨å¸‚åœºã€æ²ªå¸‚ï¼ˆ6å¼€å¤´ï¼‰ã€æ·±å¸‚ï¼ˆ0/3å¼€å¤´ï¼‰ã€åŒ—äº¤æ‰€ï¼ˆ4/8å¼€å¤´ï¼‰
- æ ¹æ®è‚¡ç¥¨ä»£ç è‡ªåŠ¨è¯†åˆ«å¸‚åœº
- ç­›é€‰æ¡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡ç½®åˆ°ç¬¬ä¸€é¡µ

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `web/client/src/pages/ReportDetail.tsx`

**å…³é”®ä»£ç **ï¼š
```typescript
// å¸‚åœºè¯†åˆ«å‡½æ•°
const getMarket = (code: string): "sh" | "sz" | "bj" => {
  if (code.startsWith('6')) return 'sh';  // æ²ªå¸‚
  if (code.startsWith('8') || code.startsWith('4')) return 'bj';  // åŒ—äº¤æ‰€
  return 'sz';  // æ·±å¸‚
};

// å¸‚åœºç­›é€‰é€»è¾‘
const matchMarket = marketFilter === "all" || getMarket(report.code) === marketFilter;
```

---

### âœ… ä»»åŠ¡4ï¼šæˆªæ­¢æ—¥æœŸåŠ¨æ€æ˜¾ç¤º

**å®ç°æ–¹æ¡ˆ**ï¼š
- `full_backtest.py` ç”Ÿæˆæ•°æ®æ—¶æ·»åŠ  `last_update` å­—æ®µï¼ˆæ ¼å¼ï¼šYYYY-MM-DDï¼‰
- `ReportDetail.tsx` è¯»å–è¯¥å­—æ®µå¹¶åŠ¨æ€æ˜¾ç¤ºåœ¨é¡µé¢æ ‡é¢˜ä¸­
- å¦‚æœå­—æ®µä¸å­˜åœ¨ï¼Œä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºé»˜è®¤å€¼

**ä¿®æ”¹æ–‡ä»¶**ï¼š
- `py_file/full_backtest.py` (æ·»åŠ  last_update å­—æ®µ)
- `web/client/src/pages/ReportDetail.tsx` (è¯»å–å¹¶æ˜¾ç¤ºæ—¥æœŸ)
- `web/client/src/data/backtest_results.json` (æ›´æ–°æ•°æ®)

**æ•ˆæœ**ï¼š
- é¡µé¢æ ‡é¢˜ä»å›ºå®šçš„"æˆªæ­¢åˆ°2025å¹´1æœˆ6æ—¥"å˜ä¸ºåŠ¨æ€çš„"æˆªæ­¢åˆ° {lastUpdateDate}"
- æ¯æ¬¡å›æµ‹åè‡ªåŠ¨æ›´æ–°ä¸ºæœ€æ–°æ—¥æœŸ

---

### âœ… ä»»åŠ¡5ï¼šLinux äº‘æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ

**æ–‡æ¡£å†…å®¹**ï¼š
åˆ›å»º `deploy/linux_deployment_guide.md`ï¼ŒåŒ…å«ï¼š

1. **ç³»ç»Ÿæ¦‚è¿°**ï¼šéƒ¨ç½²æ¶æ„å’Œç»„ä»¶è¯´æ˜
2. **æœåŠ¡å™¨è¦æ±‚**ï¼šç¡¬ä»¶é…ç½®å’Œè½¯ä»¶ç¯å¢ƒ
3. **è¯¦ç»†éƒ¨ç½²æ­¥éª¤**ï¼š
   - å®‰è£…åŸºç¡€ç¯å¢ƒï¼ˆGit, Python, Node.js, Nginxï¼‰
   - å…‹éš†é¡¹ç›®å¹¶è®¾ç½®åç«¯
   - é¦–æ¬¡æ•°æ®ä¸‹è½½ä¸å›æµ‹
   - æ„å»ºå¹¶éƒ¨ç½²å‰ç«¯
   - é…ç½® Nginx
   - å®‰è£…è‡ªåŠ¨åŒ–å®šæ—¶ä»»åŠ¡
4. **ç³»ç»Ÿç»´æŠ¤ä¸æ›´æ–°**ï¼šä»£ç æ›´æ–°ã€æ—¥å¿—æŸ¥çœ‹
5. **å¸¸è§é—®é¢˜ (FAQ)**ï¼šå¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

**æ–°å¢æ–‡ä»¶**ï¼š
- `deploy/linux_deployment_guide.md`

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

### æ–°å¢æ–‡ä»¶ (7ä¸ª)
| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|---------|------|
| `py_file/auto_update_daily.py` | è‡ªåŠ¨åŒ–ä»»åŠ¡ä¸»è„šæœ¬ |
| `py_file/fix_backtest_json.py` | æ•°æ®ç»“æ„ä¿®å¤è„šæœ¬ |
| `deploy/tdx-backtest-update.service` | systemd service é…ç½® |
| `deploy/tdx-backtest-update.timer` | systemd timer é…ç½® |
| `deploy/crontab.txt` | crontab é…ç½®ç¤ºä¾‹ |
| `deploy/install_timer.sh` | å®šæ—¶ä»»åŠ¡å®‰è£…è„šæœ¬ |
| `deploy/linux_deployment_guide.md` | Linux éƒ¨ç½²å®Œæ•´æŒ‡å— |

### ä¿®æ”¹æ–‡ä»¶ (3ä¸ª)
| æ–‡ä»¶è·¯å¾„ | ä¸»è¦ä¿®æ”¹ |
|---------|---------|
| `py_file/full_backtest.py` | æ·»åŠ  last_update å­—æ®µç”Ÿæˆé€»è¾‘ |
| `web/client/src/pages/ReportDetail.tsx` | æ·»åŠ å¸‚åœºç­›é€‰å’ŒåŠ¨æ€æ—¥æœŸæ˜¾ç¤º |
| `web/client/src/data/backtest_results.json` | è¡¥å…¨æ•°æ®ç»“æ„ |

### ä»£ç ç»Ÿè®¡
- **æ–°å¢ä»£ç è¡Œæ•°**: 733 è¡Œ
- **ä¿®æ”¹ä»£ç è¡Œæ•°**: 18 è¡Œ
- **æ€»è®¡**: 751 è¡Œ

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. æ‰‹åŠ¨è¿è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡

```bash
cd /home/ubuntu/tdx-strategy-backtest/py_file
python3 auto_update_daily.py
```

### 2. å®‰è£…å®šæ—¶ä»»åŠ¡ (systemd)

```bash
cd /home/ubuntu/tdx-strategy-backtest/deploy
sudo ./install_timer.sh
```

### 3. æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹ timer çŠ¶æ€
sudo systemctl status tdx-backtest-update.timer

# æŸ¥çœ‹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
sudo systemctl list-timers tdx-backtest-update.timer

# æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—
sudo journalctl -u tdx-backtest-update.service -f
```

### 4. æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡ä»»åŠ¡

```bash
sudo systemctl start tdx-backtest-update.service
```

### 5. éƒ¨ç½²åˆ° Linux äº‘æœåŠ¡å™¨

è¯·å‚è€ƒ `deploy/linux_deployment_guide.md` æ–‡æ¡£ã€‚

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. é¦–æ¬¡å›æµ‹æ—¶é—´
- å®Œæ•´å›æµ‹å¤„ç† 5000+ åªè‚¡ç¥¨ï¼Œå¯èƒ½éœ€è¦æ•°å°æ—¶
- å»ºè®®åœ¨ `screen` æˆ– `tmux` ä¸­è¿è¡Œï¼Œé¿å… SSH æ–­å¼€

### 2. å®šæ—¶ä»»åŠ¡æ‰§è¡Œæ—¶é—´
- é»˜è®¤è®¾ç½®ä¸ºæ¯å¤© 16:00 æ‰§è¡Œ
- è‚¡å¸‚æ”¶ç›˜æ—¶é—´ä¸º 15:00ï¼Œç•™å‡º1å°æ—¶ç¼“å†²æ—¶é—´ç¡®ä¿æ•°æ®æ›´æ–°å®Œæˆ
- å¯åœ¨ `deploy/tdx-backtest-update.timer` ä¸­ä¿®æ”¹æ‰§è¡Œæ—¶é—´

### 3. æ—¥å¿—æ–‡ä»¶ä½ç½®
- è‡ªåŠ¨åŒ–ä»»åŠ¡æ—¥å¿—ï¼š`/home/ubuntu/tdx-strategy-backtest/logs/auto_update_YYYYMMDD.log`
- systemd æ—¥å¿—ï¼š`sudo journalctl -u tdx-backtest-update.service`

### 4. æ•°æ®æ›´æ–°æµç¨‹
```
16:00 å®šæ—¶ä»»åŠ¡è§¦å‘
  â†“
ä¸‹è½½æœ€æ–°è‚¡ç¥¨æ•°æ® (30-60åˆ†é’Ÿ)
  â†“
æ‰§è¡Œå®Œæ•´å›æµ‹ (1-3å°æ—¶)
  â†“
ç”Ÿæˆ JSON æ•°æ®æ–‡ä»¶
  â†“
å‰ç«¯è‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°æ•°æ®
```

---

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå®šæ—¶ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œ

**æ£€æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥ timer æ˜¯å¦å¯ç”¨
sudo systemctl is-enabled tdx-backtest-update.timer

# 2. æ£€æŸ¥ timer çŠ¶æ€
sudo systemctl status tdx-backtest-update.timer

# 3. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u tdx-backtest-update.service -n 50
```

### é—®é¢˜2ï¼šç½‘é¡µæ˜¾ç¤ºæ—§æ•°æ®

**æ£€æŸ¥æ­¥éª¤**ï¼š
```bash
# 1. æ£€æŸ¥æ•°æ®æ–‡ä»¶æœ€åä¿®æ”¹æ—¶é—´
ls -lh /home/ubuntu/tdx-strategy-backtest/web/client/src/data/backtest_results.json

# 2. æŸ¥çœ‹ last_update å­—æ®µ
cat /home/ubuntu/tdx-strategy-backtest/web/client/src/data/backtest_results.json | grep last_update

# 3. æ‰‹åŠ¨è¿è¡Œå›æµ‹
cd /home/ubuntu/tdx-strategy-backtest/py_file
python3 full_backtest.py
```

### é—®é¢˜3ï¼šå¸‚åœºç­›é€‰ä¸ç”Ÿæ•ˆ

**æ£€æŸ¥æ­¥éª¤**ï¼š
- ç¡®ä¿å‰ç«¯ä»£ç å·²æ›´æ–°å¹¶é‡æ–°æ„å»º
- æ¸…é™¤æµè§ˆå™¨ç¼“å­˜åé‡æ–°è®¿é—®
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ JavaScript é”™è¯¯

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å›æµ‹ç³»ç»Ÿè¯¦ç»†å¼€å‘è¯´æ˜.md](../å›æµ‹ç³»ç»Ÿè¯¦ç»†å¼€å‘è¯´æ˜.md) - ç³»ç»Ÿæ¶æ„å’Œå¼€å‘æŒ‡å—
- [ä¿®æ”¹æ€»ç»“.md](../ä¿®æ”¹æ€»ç»“.md) - ä¸Šä¸€æ¬¡ä¿®æ”¹çš„è¯¦ç»†è®°å½•
- [deploy/linux_deployment_guide.md](./linux_deployment_guide.md) - Linux éƒ¨ç½²å®Œæ•´æŒ‡å—
- [README.md](../README.md) - é¡¹ç›®æ€»ä½“è¯´æ˜

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä»»åŠ¡æˆåŠŸå®Œæˆäº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. âœ… ä¿®å¤äº†ç½‘é¡µå›æµ‹æ•°æ®æŠ¥é”™é—®é¢˜
2. âœ… å®ç°äº†å®Œæ•´çš„è‡ªåŠ¨åŒ–å®šæ—¶ä»»åŠ¡ç³»ç»Ÿ
3. âœ… å¢å¼ºäº†æŠ¥å‘Šæ˜ç»†çš„å¸‚åœºç­›é€‰åŠŸèƒ½
4. âœ… å®ç°äº†æˆªæ­¢æ—¥æœŸçš„åŠ¨æ€æ˜¾ç¤º
5. âœ… æä¾›äº†å®Œæ•´çš„ Linux äº‘æœåŠ¡å™¨éƒ¨ç½²æ–¹æ¡ˆ

ç³»ç»Ÿç°å·²å…·å¤‡**å®Œå…¨è‡ªåŠ¨åŒ–**çš„èƒ½åŠ›ï¼Œæ¯å¤©è‡ªåŠ¨ä¸‹è½½æ•°æ®ã€æ‰§è¡Œå›æµ‹å¹¶æ›´æ–°å‰ç«¯å±•ç¤ºï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

æ‰€æœ‰ä¿®æ”¹å·²æ¨é€åˆ° GitHubï¼ŒCommit: `5786d725`
