# 股票策略回测与分析系统 - 开发说明文档

**版本**: 2.1.0
**更新日期**: 2026-01-16

---

## 1. 系统概述

本系统是一个集数据获取、策略回测、信号分析和Web可视化于一体的全栈量化研究平台。旨在为A股市场的技术分析爱好者和量化研究者提供一套完整、高效、易于扩展的工具链。

### 1.1. 设计哲学

- **数据驱动**: 所有分析和回测都基于真实的历史日线数据。
- **模块化与解耦**: 后端Python脚本与前端Web应用分离，通过JSON文件进行数据交换，降低耦合度。
- **自动化**: 脚本设计旨在实现最大程度的自动化，减少手动操作，如自动数据更新、报告生成和Web数据同步。
- **性能与效率**: 广泛使用多进程并行处理（CPU核心数-1），大幅缩短全市场数据扫描和回测的时间。
- **可扩展性**: 代码结构清晰，方便开发者添加新的技术指标、回测策略或分析维度。

### 1.2. 技术栈

| 模块 | 技术 | 主要作用 |
| :--- | :--- | :--- |
| **后端 (Python)** | Python 3.8+ | 核心编程语言 |
| | Pandas, NumPy | 高效的数据处理与科学计算 |
| | AKShare | 获取A股历史日线数据 |
| | `multiprocessing` | 实现多进程并行计算，提升性能 |
| **前端 (Web)** | React 18 | 构建用户界面的核心框架 |
| | TypeScript | 提供静态类型检查，增强代码健壮性 |
| | TailwindCSS | 用于快速构建现代化、响应式的UI |
| | Chart.js | 绘制各类统计图表 |
| **数据交换** | JSON | 作为前后端数据交换的标准格式 |

---

## 2. 数据流线图

本图详细描述了从数据获取到前端展示的完整自动化流程。

```mermaid
graph TD
    subgraph A[Phase 1: 数据获取]
        A1(data_fetcher.py) -- "`--full` 或 `--today`" --> A2{AKShare API}
        A2 -- 日线行情 --> A1
        A1 -- "存储/更新" --> A3[data/day/*.csv]
    end

    subgraph B[Phase 2: 回测与分析]
        B1(single_strategy_backtest.py) -- 读取 --> A3
        B2(combo_strategy_backtest.py) -- 读取 --> A3
        B3(signal_success_scanner.py) -- 读取 --> A3
        B4(pattern_analyzer.py) -- 读取 --> B5[report/signal_success_cases.csv]
        
        B1 -- "生成Web数据" --> C1[web/client/src/data/backtest_single.json]
        B2 -- "生成Web数据" --> C2[web/client/src/data/backtest_combo.json]
        B3 -- "生成Web数据" --> C3[web/client/src/data/signal_summary.json]
        B3 -- "生成中间文件" --> B5
        B4 -- "生成Web数据" --> C4[web/client/src/data/pattern_summary.json]
    end

    subgraph C[Phase 3: 前端展示]
        C1 & C2 & C3 & C4 -- "React组件直接导入" --> C5{Web应用}
        C5 -- "浏览器访问" --> C6[用户界面]
    end

    style A1 fill:#FFDAB9,stroke:#333,stroke-width:2px
    style B1 fill:#ADD8E6,stroke:#333,stroke-width:2px
    style B2 fill:#ADD8E6,stroke:#333,stroke-width:2px
    style B3 fill:#ADD8E6,stroke:#333,stroke-width:2px
    style B4 fill:#ADD8E6,stroke:#333,stroke-width:2px
    style C5 fill:#90EE90,stroke:#333,stroke-width:2px
```

---

## 3. 后端模块详细说明 (`py_file/`)

### 3.1. `data_fetcher.py` - 数据获取模块

- **功能**: 负责从`AKShare`获取数据并进行本地化存储和管理。
- **使用方法**:
  ```bash
  # 首次使用，下载全部历史数据
  python3 data_fetcher.py --full

  # 每日收盘后，增量更新当天数据
  python3 data_fetcher.py --today

  # 下载指定日期范围内的数据并覆盖本地
  python3 data_fetcher.py --date 20260101 20260115
  ```

### 3.2. 回测与分析脚本

- **`single_strategy_backtest.py`**: 单指标策略回测引擎。
    - **功能**: 整合了六脉神剑、买卖点、缠论等多种单点策略的回测。
    - **使用方法**: `python3 single_strategy_backtest.py`

- **`combo_strategy_backtest.py`**: 组合策略回测引擎。
    - **功能**: 回测“稳健型”和“激进型”两种多指标组合策略。
    - **使用方法**: `python3 combo_strategy_backtest.py`

- **`signal_success_scanner.py`**: 信号成功案例扫描器。
    - **功能**: 扫描全市场股票，找出成功的买入信号案例。
    - **使用方法**: `python3 signal_success_scanner.py`

- **`pattern_analyzer.py`**: 成功案例模式分析器。
    - **功能**: 对成功案例进行深度分析，挖掘共性模式。
    - **使用方法**: `python3 pattern_analyzer.py`

### 3.3. 核心库

- **`indicators.py`**: 技术指标库，定义了所有指标的计算函数。
- **`backtest_utils.py`**: 回测工具库，封装了多进程、结果汇总等通用功能。

---

## 4. 前端模块详细说明 (`web/`)

前端采用React框架，负责将后端生成的JSON数据进行可视化展示。

### 4.1. 目录结构

- `src/pages/`: 存放各个页面的主组件。
- `src/components/`: 存放可复用的UI组件。
- `src/data/`: **核心数据目录**，存放所有由Python脚本生成的JSON文件。
- `src/App.tsx`: 应用主入口，负责路由配置。

### 4.2. 数据流

1.  **Python脚本**: 运行后，将计算结果以JSON格式保存到`web/client/src/data/`目录下。
2.  **React组件**: 页面组件通过`import`语句直接导入这些JSON文件作为静态数据。
3.  **渲染**: 组件使用导入的数据来渲染图表和表格。

---

## 5. 扩展与二次开发指南

### 5.1. 添加新的技术指标

1.  在`indicators.py`中添加一个新的计算函数。
2.  函数必须接收一个DataFrame并返回一个带有新指标列的DataFrame。
3.  在需要使用该指标的回测或分析脚本中导入并调用该函数。

### 5.2. 添加新的回测策略

1.  **单指标策略**: 在`single_strategy_backtest.py`中，仿照现有函数创建一个新的回测函数，并在`run_backtest()`中注册。
2.  **组合策略**: 在`combo_strategy_backtest.py`的`backtest_aggressive_single()`函数中，在`combos`字典里添加新的组合条件。

---

**文档结束**
